# NOTE

## 模型准备

我们做出了以下假设来帮助我们建模

- 假设数据准确, 我们没有伪造数据
- 假设两种投资产品的价值不受外界主观因素影响
- 假设16年之前没有任何历史数据
- 假设两种投资产品符合普遍投资规律，即公式系数来自经验规律

## 符号

## task1

### 数据预处理

对于给定的数据，由于有特定黄金的交易日(即工作日), 比特币每天都可交易，同时黄金的价格在休息日不会发生变化，为了方便表示，我们将量表进行合并。同时将休息日的黄金价格用过去最近的交易日价格填补。

为了更好的量化交易策略，模型需要额外添加几项指标：'单日涨幅',投资风险'，历史分位点，MACD指标

单日涨幅公式:(present - prev) / prev

历史分位点是为了显示当前估值在所有估值历史的位置，能够展示当前是高估状态还是低估状态。

估值分位点计算算法：

step 1:将当天价格和过去n天价格进行排位并去除重复项，的到排名q，

step 2: 用计算公式：quantile = (q - 1) * 100%/ (n - 1) 

整体上，分位点越低， 估值越低；分位点越高，估值越高

MACD指标(平滑移动平均线)，是从双指数移动平均线变换得出；

MACD的意义和双移动平均线基本相同，即由快、慢均线的离散、聚合表征当前的多空状态和股价可能的发展变化趋势；当MACD从负数转向正数，是买的信号。当MACD从正数转向负数，是卖的信号。当MACD以大角度变化，表示快的移动平均线和慢的移动平均线的差距非常迅速的拉开，代表了一个市场大趋势的转变。

MACD指标的计算方法：

由快的指数移动平均线(EMA(n1)),减去慢的指数移动平均线（EMA(n2)）得到快线DIF；再用DIF的9日指数平滑移动得到慢线DEA；再用2×（快线DIF-加权移动均线DEA）得到MACD柱。即MACD:(DIF-DEA)*2;

step 1:EMA初始化：通常情况下，EMA1是没有定义的，通常情况下取EMA1为Price1，即数据的第一项填充为EMA的第一项。

step 2: 
EMAtoday = α * Pricetoday + ( 1 - α ) * EMAyesterday；



step 3: DIF = EMA(n1)-EMA(n2);

step 4: DEA=（前一日DEA X a+今日DIF X a）;

step 5: MACD=（DIF-DEA）*2;

α为平滑指数，一般取作2/(N+1)。在计算本数据的MACD指标时，EMA计算中，经过我们的调查，我们选取12和26天，即 n1=12, n2=26

### 模型总览

------------------
1.计算公式：
DIF:EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);
DEA:EMA(DIF,MID);
MACD:(DIF-DEA)*2;
2.可变参数说明：
上式中，SHORT、LONG、MID是可变参数，三个参数都是EMA公式中α的取值（EMA计算公式在前文有介绍）。通常情况下，业内公认的三个取值为：12，26，9。
3.初始化说明：
通常DIF,DEA,MACD的初始值用0补足。不过这个0并不是刻意补上去的，而是根据EMA初始化规则，自然而然算出来的DIF,DEA,MACD初始值都为0。

EMA（Exponential Moving Average），指数平均数指标。也叫EXPMA指标，它也是一种趋向类指标，指数平均数指标是以指数式递减加权的移动平均。
1.计算公式：
EMAtoday=α * Pricetoday + ( 1 - α ) * EMAyesterday；
2.可变参数说明：
α为平滑指数，一般取作2/(N+1)。在计算MACD指标时，EMA计算中的N一般选取12和26天，因此α相应为2/13和2/27；在计算DEA时，EMA中的N一般选取为9天，即α为2/10。
3.初始化说明：
EMA1是没有定义的，通常情况下取EMA1为Price1，即数据的第一项填充为EMA的第一项。


比如一家公司的过去11天PE估值分别为：2.1、1.1、9.1、5.1、4.1、11.1、8.1、10.1、6.1、7.1、9.1，共11个样本点，而今天这家公司的PE的估值是3.1，也就是第12个样本点。接下来就算一下今天PE估值3.1在12个样本中的位置，也就是分位点是多少。

第一步，剔除重复的数据，只保留一个。对于该例子来说，也就是只保留一个9.1，这时就剩下11个样本点，届时3.1的真实排位就是11。

第二步，把11个样本点，按从小到大的顺序排列，这时3.1就从第11位排到第3位了。

第三步，计算3.1的百分位，公式是(3 - 1) / (11 - 1) = 20%，其中的1、3、11都是排位。

注意：分位点计算要减1，这样才能满足0%到100%的排序，不然第1位1.1的分位点就是1/11=9.1%，实际分位点是0%；同理如果当前值是11.1，那么分位点就是100%


凯利公式同时也告诉我们，如果我们获胜概率低于50%，不要投入资金。也就是说，估值高的时候不要入场。

如果获胜概率90%，那仓位=2*90%-1=80%，也就是要有八成仓位。


本文使用交叉法则来对 MA 策略进行模拟检验。交叉法则的交易原则如下，
如果短期均线自下而上突破长期均线形成金叉，视为买进时机，如果长期均线从
上而下突破短期均线形成死叉，视为卖出时机，投资者可根据相应的买卖信号进
行交易。 

MACD 采用的交易原则为：当 DIFF 和 DEA 取值都是正的，而且 DIFF 自下向
上穿过 DEA 形成所谓的金叉时，视为买入时机，应该做多。但是有一种特殊情况
存在，由于暴跌后的小反弹容易产生低位金叉，所以低位金叉比高位金叉出现次
数频繁，如果此时盲目买入会损失惨重，因此低位金叉买入要谨慎。当 DIFF 和
DEA 取值都是负的，且 DIFF 由上而下穿过 DEA 形成所谓的死叉时，视为卖出信
时机，应当做空或平仓。 

RSI 的交易原则为：由上式可知，RSI 的变动范围是 1 到 100。市场经验表
明，RSI > 50 则表明市场平均收盘上涨的可能性比较高，市场称为强势市场，
反之称为弱势市场。一般 RSI 在 30 到 70 之间波动。如果 RSI 值超过 80，则表
示市场买方市场严重溢出，要极强卖出。因为当 RSI 达到 80 以上时，价格极有
可能会下降。如果 RSI 低于 20 则表示市场卖方严重溢出，价格可能要回调要买
入。有的投资者把取值定为 15、85，


震荡技术指标—RSI 
相对强弱指标 RSI ( Relative Strength Index) 通过分析市场买卖和供求
状况来预测市场走向，最早被应用于期货交易。RSI 就是计算某时期内的平均收
盘涨跌数的关系。相对强弱指标适合震荡市场的投资交易实践，如黄金市场价格
变化的析。RSI 为震荡技术指标，其计算公式如下: 
N 日 RSI=[A÷(A+B)]×100% 
A 为 N 日内收盘跌幅之和(取正值) 
B 为 N 日内收盘跌幅之和(取正值) 
RSI 也可以表示为： 
RSI=100*RS/(1+RS)= 100-100/(1+RS) 
其中，RS=N 日的平均收盘跌幅之和(取正值)/N 日的平均收盘的跌幅之和(取
正值)。 

残差检验  
如果残差是白噪声序列，说明时间序列中有用的信息已经被提取完毕了，剩下的全是随机扰动，是无法预测和使用的。  
qq图中：如果是正态分布则为一条直线，即红线。结果大致符合白噪声


Durbin-Watson 检验，又称 DW 检验，是用来检验回归分析中残差的一阶自相关性的(尤其针对时间序列数据)。  
该统计量值越接近 2 越好，一般在 1~3 之间说明没问题，小于 1 这说明残差存在自相关性

2.038213993428896
2.034805385363646

